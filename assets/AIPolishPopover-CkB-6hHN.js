import{c as xe,u as ye,a as ge,b as C,d as _e,e as he,f as we,g as ke,h as Pe,i as Ce,_ as Se}from"./index-BrUfoELa.js";import{d as te,k as $e,i as h,y as l,u as o,R as Te,f as n,L as Ae,l as u,ai as ze,m as K,c as b,e as x,n as Be,a,b as r,F as Y,r as Z,W as j,t as _,g as Ie,T as je,v as Ve,z as Ne}from"./vendor-CTGTXVmh.js";import{X as Oe,K as Re}from"./ui-UFrwgHUv.js";import{S as De,X as ee,P as Ke}from"./res-BQY8thNo.js";import"./makedown_lib-BRTypQk8.js";import"./utils-DIfbv2wu.js";import"./awssdk-CtLjKsJm.js";import"./cosdk-CGvTWxym.js";import"./othercloudsdk-Bua4G6TZ.js";const Ee=te({__name:"SelectGroup",props:{asChild:{type:Boolean},as:{type:[String,Object,Function]},class:{}},setup(V){const S=V,N=$e(()=>{const{class:p,...m}=S;return m});return(p,m)=>(l(),h(o(Oe),Te({class:o(xe)("p-1 w-full",S.class)},N.value),{default:n(()=>[Ae(p.$slots,"default")]),_:3},16,["class"]))}}),Me={class:"flex items-center gap-2"},Fe={key:1,class:"custom-scroll space-y-3 flex-1 overflow-y-auto px-4 pb-2 pt-3 sm:px-6"},Le={class:"border-border custom-scroll bg-muted/20 text-muted-foreground max-h-32 overflow-y-auto whitespace-pre-line border rounded px-3 py-2 text-sm"},Xe={key:0},Je={class:"custom-scroll border-border max-h-24 min-h-[40px] flex flex-wrap gap-2 overflow-y-auto border rounded px-2 py-1"},Ue=["onClick"],We={key:1,class:"min-h-[24px] flex items-center text-[12px] text-red-500"},qe={key:2},Ge={class:"border-border flex justify-end gap-2 border-t px-6 pb-3 pt-2"},He=te({__name:"AIPolishPopover",props:{position:{},selectedText:{},isDragging:{type:Boolean},isMobile:{type:Boolean}},emits:["closeBtn","recalcPos","startDrag"],setup(V,{expose:S,emit:N}){const p=V,m=N,$=u(!1),w=u(!1),f=u(""),d=u(!1),y=u(null),v=u([]),k=u(!1),g=u("optimize"),P=u(""),T=u(""),oe=ye(),O=u(null),se=ge(),{apiKey:E,endpoint:ae,model:le,temperature:re,maxToken:ne,type:ue}=ze(se),M=[{value:"optimize",label:"优化文本",defaultPrompt:"请优化文本，使其更通顺易读。"},{value:"summarize",label:"文章总结",defaultPrompt:"请对文本进行摘要，输出主要观点和结论。"},{value:"spellcheck",label:"错别字纠正",defaultPrompt:"请找出并纠正文本中的错别字、标点和语法错误。"},{value:"translate-zh",label:"翻译为中文",defaultPrompt:"请将文本翻译为地道的中文。"},{value:"translate-en",label:"翻译为英文",defaultPrompt:"请将文本翻译为自然流畅的英文。"},{value:"custom",label:"自定义",defaultPrompt:""}];K(f,async()=>{var t;m("recalcPos"),await Ne(),(t=O.value)==null||t.scrollTo({top:O.value.scrollHeight})}),K(g,t=>{t!=="custom"&&(v.value=[])}),K(()=>p.selectedText,t=>{w.value&&(P.value=t,A())});function ie(t){const e=t.target,i=e.value.trim();i&&!v.value.includes(i)&&v.value.push(i),e.value="",m("recalcPos")}function ce(t){v.value.splice(t,1)}function A(){var t;f.value="",d.value=!1,k.value=!1,T.value="",(t=y.value)==null||t.abort(),y.value=null}async function F(){var q,G,H;const t=P.value.trim();if(!t||d.value)return;A(),d.value=!0,y.value=new AbortController;const e="你是一名专业的多语言文本助手，请根据用户的指令处理下列内容。在输出时，不要输出任何额外的信息，只输出处理后的文本。",i=M.find(c=>c.value===g.value),s=[];i.defaultPrompt&&s.push(i.defaultPrompt),v.value.length&&s.push(`请同时满足以下要求：${v.value.join("、")}。`),s.length||s.push("请根据最佳实践优化文本。");const z=s.join(" "),U=[{role:"system",content:e},{role:"user",content:`${z}

待处理文本：
${t}`}],pe={model:le.value,messages:U,temperature:re.value,max_tokens:ne.value,stream:!0},W={"Content-Type":"application/json"};E.value&&ue.value!=="default"&&(W.Authorization=`Bearer ${E.value}`);try{const c=new URL(ae.value);c.pathname.endsWith("/chat/completions")||(c.pathname=c.pathname.replace(/\/?$/,"/chat/completions"));const B=await window.fetch(c.toString(),{method:"POST",headers:W,body:JSON.stringify(pe),signal:y.value.signal});if(!B.ok||!B.body)throw new Error(`响应错误：${B.status}`);const me=B.body.getReader(),fe=new TextDecoder("utf-8");let R="";for(;;){const{value:ve,done:be}=await me.read();if(be)break;R+=fe.decode(ve,{stream:!0});const Q=R.split(`
`);R=Q.pop()||"";for(const D of Q)if(!(!D.trim()||D.trim()==="data: [DONE]"))try{const I=(H=(G=(q=JSON.parse(D.replace(/^data: /,"")).choices)==null?void 0:q[0])==null?void 0:G.delta)==null?void 0:H.content;I!=null&&I.trim()&&(f.value+=I,k.value=!0)}catch{}}}catch(c){c.name==="AbortError"?console.log("Request aborted by user."):(console.error("请求失败：",c),T.value=c.message||"请求失败")}finally{d.value=!1}}function L(){d.value&&y.value&&(y.value.abort(),d.value=!1)}function X(){const t=Ve(oe.editor),e=t.getCursor("start");t.replaceSelection(f.value);const i=t.getCursor("end");t.setSelection(e,i),t.focus(),P.value=f.value,A()}function de(){if(m("closeBtn"),!p.selectedText.trim()){Re.error("请选择需要处理的内容");return}w.value=!0,P.value=p.selectedText,m("recalcPos")}function J(){w.value=!1,v.value=[],g.value="optimize",A()}return S({visible:w,runAIAction:F,replaceText:X,show:de,close:J,stopAI:L}),(t,e)=>{const i=_e;return l(),h(je,{name:"fade-scale"},{default:n(()=>[w.value?(l(),b("div",{key:0,class:"bg-card border-border text-card-foreground fixed left-1/2 top-1/2 z-50 max-h-[90dvh] w-[90vw] flex flex-col overflow-hidden border rounded-xl shadow-2xl sm:w-[460px] -translate-x-1/2 -translate-y-1/2 sm:translate-x-0 sm:translate-y-0",style:Be(p.isMobile?{}:{left:`${t.position.left}px`,top:`${t.position.top}px`,transformOrigin:"top left"})},[a("div",{class:"border-border popover-header flex select-none items-center justify-between border-b px-4 pb-2 pt-3 sm:cursor-move sm:px-6",onMousedown:e[1]||(e[1]=s=>!p.isMobile&&m("startDrag",s))},[a("div",Me,[e[4]||(e[4]=a("span",{class:"text-lg font-bold"},"AI 工具箱",-1)),r(o(C),{variant:"ghost",size:"icon","aria-label":"配置",onClick:e[0]||(e[0]=s=>$.value=!$.value)},{default:n(()=>[r(o(De),{class:"h-4 w-4"})]),_:1})]),r(o(C),{variant:"ghost",size:"icon","aria-label":"关闭",onClick:J},{default:n(()=>[r(o(ee),{class:"h-3 w-3"})]),_:1})],32),$.value?(l(),h(i,{key:0,class:"border-border mb-4 w-full border rounded-md p-4",onSaved:e[2]||(e[2]=()=>$.value=!1)})):(l(),b("section",Fe,[a("div",null,[e[5]||(e[5]=a("div",{class:"mb-1 text-sm font-semibold"}," 选择操作 ",-1)),r(o(he),{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=s=>g.value=s)},{default:n(()=>[r(o(we),{class:"w-full"},{default:n(()=>[r(o(ke),{placeholder:"请选择要执行的操作"})]),_:1}),r(o(Pe),null,{default:n(()=>[r(o(Ee),null,{default:n(()=>[(l(),b(Y,null,Z(M,s=>r(o(Ce),{key:s.value,value:s.value},{default:n(()=>[j(_(s.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a("div",null,[e[6]||(e[6]=a("div",{class:"mb-1 text-sm font-semibold"}," 原文 ",-1)),a("div",Le,_(P.value),1)]),g.value==="custom"?(l(),b("div",Xe,[e[7]||(e[7]=a("div",{class:"mb-1 text-sm font-semibold"}," 自定义提示词（可选） ",-1)),a("div",Je,[(l(!0),b(Y,null,Z(v.value,(s,z)=>(l(),b("div",{key:z,class:"text-muted-foreground bg-muted flex items-center gap-1 rounded-full px-2 py-1 text-sm"},[a("span",null,_(s),1),a("button",{class:"hover:bg-muted/60 h-4 w-4 flex items-center justify-center rounded-full",onClick:U=>ce(z)},[r(o(ee),{class:"h-3 w-3"})],8,Ue)]))),128)),a("input",{class:"min-w-[100px] flex-1 bg-transparent py-1 text-sm focus:outline-none",placeholder:"输入提示词后按回车",onKeydown:Ie(ie,["enter"])},null,32)])])):x("",!0),T.value?(l(),b("div",We,_(T.value),1)):x("",!0),f.value?(l(),b("div",qe,[e[8]||(e[8]=a("div",{class:"mb-1 text-sm font-semibold"}," 处理结果 ",-1)),a("div",{ref_key:"resultContainer",ref:O,class:"custom-scroll border-border bg-background max-h-40 min-h-[60px] overflow-y-auto whitespace-pre-line border rounded px-3 py-2 text-sm"},_(f.value),513)])):x("",!0),a("div",Ge,[d.value?(l(),h(o(C),{key:0,variant:"secondary",onClick:L},{default:n(()=>[r(o(Ke),{class:"mr-1 h-4 w-4"}),e[9]||(e[9]=j(" 终止 "))]),_:1,__:[9]})):x("",!0),k.value&&!d.value?(l(),h(o(C),{key:1,variant:"default",onClick:X},{default:n(()=>e[10]||(e[10]=[j(" 接受 ")])),_:1,__:[10]})):x("",!0),d.value?x("",!0):(l(),h(o(C),{key:2,variant:"outline",disabled:!k.value&&!!f.value,onClick:F},{default:n(()=>[j(_(k.value?"重试":"AI 处理"),1)]),_:1},8,["disabled"]))])]))],4)):x("",!0)]),_:1})}}}),nt=Se(He,[["__scopeId","data-v-8c64d8a0"]]);export{nt as default};
