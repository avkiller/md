import{E as ht}from"./vendor-ljWLLzwe.js";import{r as dt}from"./utils-CHzl_7bT.js";var Ve=function(){var a=function(r,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var t in n)n.hasOwnProperty(t)&&(o[t]=n[t])},a(r,e)};return function(r,e){a(r,e);function o(){this.constructor=r}r.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),C;(function(a){a.InvalidFile="InvalidFile",a.InvalidToken="InvalidToken",a.InvalidMetadata="InvalidMetadata",a.InvalidChunkSize="InvalidChunkSize",a.InvalidCustomVars="InvalidCustomVars",a.NotAvailableUploadHost="NotAvailableUploadHost",a.ReadCacheFailed="ReadCacheFailed",a.InvalidCacheData="InvalidCacheData",a.WriteCacheFailed="WriteCacheFailed",a.RemoveCacheFailed="RemoveCacheFailed",a.GetCanvasContextFailed="GetCanvasContextFailed",a.UnsupportedFileType="UnsupportedFileType",a.FileReaderReadFailed="FileReaderReadFailed",a.NotAvailableXMLHttpRequest="NotAvailableXMLHttpRequest",a.InvalidProgressEventTarget="InvalidProgressEventTarget",a.RequestError="RequestError"})(C||(C={}));var A=function(){function a(r,e){this.name=r,this.message=e,this.stack=new Error().stack}return a}(),$=function(a){Ve(r,a);function r(e,o,n,t){var u=a.call(this,C.RequestError,n)||this;return u.code=e,u.reqId=o,u.isRequestError=!0,u.data=t,u}return r}(A),Ne=function(a){Ve(r,a);function r(e,o){return o===void 0&&(o=""),a.call(this,0,o,e)||this}return r}($),pt=function(){function a(r,e){this.runTask=r,this.limit=e,this.aborted=!1,this.queue=[],this.processing=[]}return a.prototype.enqueue=function(r){var e=this;return new Promise(function(o,n){e.queue.push({task:r,resolve:o,reject:n}),e.check()})},a.prototype.run=function(r){var e=this;this.queue=this.queue.filter(function(o){return o!==r}),this.processing.push(r),this.runTask(r.task).then(function(){e.processing=e.processing.filter(function(o){return o!==r}),r.resolve(),e.check()},function(o){return r.reject(o)})},a.prototype.check=function(){var r=this;if(!this.aborted){var e=this.processing.length,o=this.limit-e;this.queue.slice(0,o).forEach(function(n){r.run(n)})}},a.prototype.abort=function(){this.queue=[],this.aborted=!0},a}(),vt=function(){var a=function(r,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var t in n)n.hasOwnProperty(t)&&(o[t]=n[t])},a(r,e)};return function(r,e){a(r,e);function o(){this.constructor=r}r.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),V=function(){return V=Object.assign||function(a){for(var r,e=1,o=arguments.length;e<o;e++){r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},V.apply(this,arguments)},yt=function(){function a(){this.closed=!1}return a.prototype.unsubscribe=function(){this.closed||(this.closed=!0,this._unsubscribe&&this._unsubscribe())},a.prototype.add=function(r){this._unsubscribe=r},a}(),gt=function(a){vt(r,a);function r(e,o,n){var t=a.call(this)||this;return t.isStopped=!1,e&&typeof e=="object"?t.destination=e:t.destination=V(V(V({},e&&{next:e}),o&&{error:o}),n&&{complete:n}),t}return r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,a.prototype.unsubscribe.call(this))},r.prototype.next=function(e){!this.isStopped&&this.destination.next&&this.destination.next(e)},r.prototype.error=function(e){!this.isStopped&&this.destination.error&&(this.isStopped=!0,this.destination.error(e))},r.prototype.complete=function(e){!this.isStopped&&this.destination.complete&&(this.isStopped=!0,this.destination.complete(e))},r}(yt),mt=function(){function a(r){this._subscribe=r}return a.prototype.subscribe=function(r,e,o){var n=new gt(r,e,o);return n.add(this._subscribe(n)),n},a}();function wt(a){if(a===null||typeof a>"u")return"";var r=a+"",e="",o,n,t=0;o=n=0,t=r.length;for(var u=0;u<t;u++){var f=r.charCodeAt(u),w=null;if(f<128)n++;else if(f>127&&f<2048)w=String.fromCharCode(f>>6|192,f&63|128);else if((f&63488^55296)>0)w=String.fromCharCode(f>>12|224,f>>6&63|128,f&63|128);else{if((f&64512^55296)>0)throw new RangeError("Unmatched trail surrogate at "+u);var i=r.charCodeAt(++u);if((i&64512^56320)>0)throw new RangeError("Unmatched lead surrogate at "+(u-1));f=((f&1023)<<10)+(i&1023)+65536,w=String.fromCharCode(f>>18|240,f>>12&63|128,f>>6&63|128,f&63|128)}w!==null&&(n>o&&(e+=r.slice(o,n)),e+=w,o=n=u+1)}return n>o&&(e+=r.slice(o,t)),e}function bt(a){var r=[],e=0,o=0,n=0;for(a+="";e<a.length;){o=a.charCodeAt(e)&255,n=0,o<=191?(o=o&127,n=1):o<=223?(o=o&31,n=2):o<=239?(o=o&15,n=3):(o=o&7,n=4);for(var t=1;t<n;++t)o=o<<6|a.charCodeAt(t+e)&63;n===4?(o-=65536,r.push(String.fromCharCode(55296|o>>10&1023)),r.push(String.fromCharCode(56320|o&1023))):r.push(String.fromCharCode(o)),e+=n}return r.join("")}function _t(a){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e,o,n,t,u,f,w,i,s=0,h=0,d="",v=[];if(!a)return a;a=wt(a+"");do e=a.charCodeAt(s++),o=a.charCodeAt(s++),n=a.charCodeAt(s++),i=e<<16|o<<8|n,t=i>>18&63,u=i>>12&63,f=i>>6&63,w=i&63,v[h++]=r.charAt(t)+r.charAt(u)+r.charAt(f)+r.charAt(w);while(s<a.length);switch(d=v.join(""),a.length%3){case 1:d=d.slice(0,-2)+"==";break;case 2:d=d.slice(0,-1)+"=";break}return d}function xt(a){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e,o,n,t,u,f,w,i,s=0,h=0,d="",v=[];if(!a)return a;a+="";do t=r.indexOf(a.charAt(s++)),u=r.indexOf(a.charAt(s++)),f=r.indexOf(a.charAt(s++)),w=r.indexOf(a.charAt(s++)),i=t<<18|u<<12|f<<6|w,e=i>>16&255,o=i>>8&255,n=i&255,f===64?v[h++]=String.fromCharCode(e):w===64?v[h++]=String.fromCharCode(e,o):v[h++]=String.fromCharCode(e,o,n);while(s<a.length);return d=v.join(""),bt(d)}function B(a){return a=_t(a),a.replace(/\//g,"_").replace(/\+/g,"-")}function Xe(a){return a=a.replace(/_/g,"/").replace(/-/g,"+"),xt(a)}var re={exports:{}},_e;function St(){return _e||(_e=1,function(a,r){(function(e){a.exports=e()})(function(e){var o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(m,y){var c=m[0],l=m[1],g=m[2],p=m[3];c+=(l&g|~l&p)+y[0]-680876936|0,c=(c<<7|c>>>25)+l|0,p+=(c&l|~c&g)+y[1]-389564586|0,p=(p<<12|p>>>20)+c|0,g+=(p&c|~p&l)+y[2]+606105819|0,g=(g<<17|g>>>15)+p|0,l+=(g&p|~g&c)+y[3]-1044525330|0,l=(l<<22|l>>>10)+g|0,c+=(l&g|~l&p)+y[4]-176418897|0,c=(c<<7|c>>>25)+l|0,p+=(c&l|~c&g)+y[5]+1200080426|0,p=(p<<12|p>>>20)+c|0,g+=(p&c|~p&l)+y[6]-1473231341|0,g=(g<<17|g>>>15)+p|0,l+=(g&p|~g&c)+y[7]-45705983|0,l=(l<<22|l>>>10)+g|0,c+=(l&g|~l&p)+y[8]+1770035416|0,c=(c<<7|c>>>25)+l|0,p+=(c&l|~c&g)+y[9]-1958414417|0,p=(p<<12|p>>>20)+c|0,g+=(p&c|~p&l)+y[10]-42063|0,g=(g<<17|g>>>15)+p|0,l+=(g&p|~g&c)+y[11]-1990404162|0,l=(l<<22|l>>>10)+g|0,c+=(l&g|~l&p)+y[12]+1804603682|0,c=(c<<7|c>>>25)+l|0,p+=(c&l|~c&g)+y[13]-40341101|0,p=(p<<12|p>>>20)+c|0,g+=(p&c|~p&l)+y[14]-1502002290|0,g=(g<<17|g>>>15)+p|0,l+=(g&p|~g&c)+y[15]+1236535329|0,l=(l<<22|l>>>10)+g|0,c+=(l&p|g&~p)+y[1]-165796510|0,c=(c<<5|c>>>27)+l|0,p+=(c&g|l&~g)+y[6]-1069501632|0,p=(p<<9|p>>>23)+c|0,g+=(p&l|c&~l)+y[11]+643717713|0,g=(g<<14|g>>>18)+p|0,l+=(g&c|p&~c)+y[0]-373897302|0,l=(l<<20|l>>>12)+g|0,c+=(l&p|g&~p)+y[5]-701558691|0,c=(c<<5|c>>>27)+l|0,p+=(c&g|l&~g)+y[10]+38016083|0,p=(p<<9|p>>>23)+c|0,g+=(p&l|c&~l)+y[15]-660478335|0,g=(g<<14|g>>>18)+p|0,l+=(g&c|p&~c)+y[4]-405537848|0,l=(l<<20|l>>>12)+g|0,c+=(l&p|g&~p)+y[9]+568446438|0,c=(c<<5|c>>>27)+l|0,p+=(c&g|l&~g)+y[14]-1019803690|0,p=(p<<9|p>>>23)+c|0,g+=(p&l|c&~l)+y[3]-187363961|0,g=(g<<14|g>>>18)+p|0,l+=(g&c|p&~c)+y[8]+1163531501|0,l=(l<<20|l>>>12)+g|0,c+=(l&p|g&~p)+y[13]-1444681467|0,c=(c<<5|c>>>27)+l|0,p+=(c&g|l&~g)+y[2]-51403784|0,p=(p<<9|p>>>23)+c|0,g+=(p&l|c&~l)+y[7]+1735328473|0,g=(g<<14|g>>>18)+p|0,l+=(g&c|p&~c)+y[12]-1926607734|0,l=(l<<20|l>>>12)+g|0,c+=(l^g^p)+y[5]-378558|0,c=(c<<4|c>>>28)+l|0,p+=(c^l^g)+y[8]-2022574463|0,p=(p<<11|p>>>21)+c|0,g+=(p^c^l)+y[11]+1839030562|0,g=(g<<16|g>>>16)+p|0,l+=(g^p^c)+y[14]-35309556|0,l=(l<<23|l>>>9)+g|0,c+=(l^g^p)+y[1]-1530992060|0,c=(c<<4|c>>>28)+l|0,p+=(c^l^g)+y[4]+1272893353|0,p=(p<<11|p>>>21)+c|0,g+=(p^c^l)+y[7]-155497632|0,g=(g<<16|g>>>16)+p|0,l+=(g^p^c)+y[10]-1094730640|0,l=(l<<23|l>>>9)+g|0,c+=(l^g^p)+y[13]+681279174|0,c=(c<<4|c>>>28)+l|0,p+=(c^l^g)+y[0]-358537222|0,p=(p<<11|p>>>21)+c|0,g+=(p^c^l)+y[3]-722521979|0,g=(g<<16|g>>>16)+p|0,l+=(g^p^c)+y[6]+76029189|0,l=(l<<23|l>>>9)+g|0,c+=(l^g^p)+y[9]-640364487|0,c=(c<<4|c>>>28)+l|0,p+=(c^l^g)+y[12]-421815835|0,p=(p<<11|p>>>21)+c|0,g+=(p^c^l)+y[15]+530742520|0,g=(g<<16|g>>>16)+p|0,l+=(g^p^c)+y[2]-995338651|0,l=(l<<23|l>>>9)+g|0,c+=(g^(l|~p))+y[0]-198630844|0,c=(c<<6|c>>>26)+l|0,p+=(l^(c|~g))+y[7]+1126891415|0,p=(p<<10|p>>>22)+c|0,g+=(c^(p|~l))+y[14]-1416354905|0,g=(g<<15|g>>>17)+p|0,l+=(p^(g|~c))+y[5]-57434055|0,l=(l<<21|l>>>11)+g|0,c+=(g^(l|~p))+y[12]+1700485571|0,c=(c<<6|c>>>26)+l|0,p+=(l^(c|~g))+y[3]-1894986606|0,p=(p<<10|p>>>22)+c|0,g+=(c^(p|~l))+y[10]-1051523|0,g=(g<<15|g>>>17)+p|0,l+=(p^(g|~c))+y[1]-2054922799|0,l=(l<<21|l>>>11)+g|0,c+=(g^(l|~p))+y[8]+1873313359|0,c=(c<<6|c>>>26)+l|0,p+=(l^(c|~g))+y[15]-30611744|0,p=(p<<10|p>>>22)+c|0,g+=(c^(p|~l))+y[6]-1560198380|0,g=(g<<15|g>>>17)+p|0,l+=(p^(g|~c))+y[13]+1309151649|0,l=(l<<21|l>>>11)+g|0,c+=(g^(l|~p))+y[4]-145523070|0,c=(c<<6|c>>>26)+l|0,p+=(l^(c|~g))+y[11]-1120210379|0,p=(p<<10|p>>>22)+c|0,g+=(c^(p|~l))+y[2]+718787259|0,g=(g<<15|g>>>17)+p|0,l+=(p^(g|~c))+y[9]-343485551|0,l=(l<<21|l>>>11)+g|0,m[0]=c+m[0]|0,m[1]=l+m[1]|0,m[2]=g+m[2]|0,m[3]=p+m[3]|0}function t(m){var y=[],c;for(c=0;c<64;c+=4)y[c>>2]=m.charCodeAt(c)+(m.charCodeAt(c+1)<<8)+(m.charCodeAt(c+2)<<16)+(m.charCodeAt(c+3)<<24);return y}function u(m){var y=[],c;for(c=0;c<64;c+=4)y[c>>2]=m[c]+(m[c+1]<<8)+(m[c+2]<<16)+(m[c+3]<<24);return y}function f(m){var y=m.length,c=[1732584193,-271733879,-1732584194,271733878],l,g,p,S,U,k;for(l=64;l<=y;l+=64)n(c,t(m.substring(l-64,l)));for(m=m.substring(l-64),g=m.length,p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<g;l+=1)p[l>>2]|=m.charCodeAt(l)<<(l%4<<3);if(p[l>>2]|=128<<(l%4<<3),l>55)for(n(c,p),l=0;l<16;l+=1)p[l]=0;return S=y*8,S=S.toString(16).match(/(.*?)(.{0,8})$/),U=parseInt(S[2],16),k=parseInt(S[1],16)||0,p[14]=U,p[15]=k,n(c,p),c}function w(m){var y=m.length,c=[1732584193,-271733879,-1732584194,271733878],l,g,p,S,U,k;for(l=64;l<=y;l+=64)n(c,u(m.subarray(l-64,l)));for(m=l-64<y?m.subarray(l-64):new Uint8Array(0),g=m.length,p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<g;l+=1)p[l>>2]|=m[l]<<(l%4<<3);if(p[l>>2]|=128<<(l%4<<3),l>55)for(n(c,p),l=0;l<16;l+=1)p[l]=0;return S=y*8,S=S.toString(16).match(/(.*?)(.{0,8})$/),U=parseInt(S[2],16),k=parseInt(S[1],16)||0,p[14]=U,p[15]=k,n(c,p),c}function i(m){var y="",c;for(c=0;c<4;c+=1)y+=o[m>>c*8+4&15]+o[m>>c*8&15];return y}function s(m){var y;for(y=0;y<m.length;y+=1)m[y]=i(m[y]);return m.join("")}s(f("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function m(y,c){return y=y|0||0,y<0?Math.max(y+c,0):Math.min(y,c)}ArrayBuffer.prototype.slice=function(y,c){var l=this.byteLength,g=m(y,l),p=l,S,U,k,R;return c!==e&&(p=m(c,l)),g>p?new ArrayBuffer(0):(S=p-g,U=new ArrayBuffer(S),k=new Uint8Array(U),R=new Uint8Array(this,g,S),k.set(R),U)}}();function h(m){return/[\u0080-\uFFFF]/.test(m)&&(m=unescape(encodeURIComponent(m))),m}function d(m,y){var c=m.length,l=new ArrayBuffer(c),g=new Uint8Array(l),p;for(p=0;p<c;p+=1)g[p]=m.charCodeAt(p);return y?g:l}function v(m){return String.fromCharCode.apply(null,new Uint8Array(m))}function b(m,y,c){var l=new Uint8Array(m.byteLength+y.byteLength);return l.set(new Uint8Array(m)),l.set(new Uint8Array(y),m.byteLength),l}function x(m){var y=[],c=m.length,l;for(l=0;l<c-1;l+=2)y.push(parseInt(m.substr(l,2),16));return String.fromCharCode.apply(String,y)}function _(){this.reset()}return _.prototype.append=function(m){return this.appendBinary(h(m)),this},_.prototype.appendBinary=function(m){this._buff+=m,this._length+=m.length;var y=this._buff.length,c;for(c=64;c<=y;c+=64)n(this._hash,t(this._buff.substring(c-64,c)));return this._buff=this._buff.substring(c-64),this},_.prototype.end=function(m){var y=this._buff,c=y.length,l,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p;for(l=0;l<c;l+=1)g[l>>2]|=y.charCodeAt(l)<<(l%4<<3);return this._finish(g,c),p=s(this._hash),m&&(p=x(p)),this.reset(),p},_.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},_.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},_.prototype.setState=function(m){return this._buff=m.buff,this._length=m.length,this._hash=m.hash,this},_.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},_.prototype._finish=function(m,y){var c=y,l,g,p;if(m[c>>2]|=128<<(c%4<<3),c>55)for(n(this._hash,m),c=0;c<16;c+=1)m[c]=0;l=this._length*8,l=l.toString(16).match(/(.*?)(.{0,8})$/),g=parseInt(l[2],16),p=parseInt(l[1],16)||0,m[14]=g,m[15]=p,n(this._hash,m)},_.hash=function(m,y){return _.hashBinary(h(m),y)},_.hashBinary=function(m,y){var c=f(m),l=s(c);return y?x(l):l},_.ArrayBuffer=function(){this.reset()},_.ArrayBuffer.prototype.append=function(m){var y=b(this._buff.buffer,m),c=y.length,l;for(this._length+=m.byteLength,l=64;l<=c;l+=64)n(this._hash,u(y.subarray(l-64,l)));return this._buff=l-64<c?new Uint8Array(y.buffer.slice(l-64)):new Uint8Array(0),this},_.ArrayBuffer.prototype.end=function(m){var y=this._buff,c=y.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g,p;for(g=0;g<c;g+=1)l[g>>2]|=y[g]<<(g%4<<3);return this._finish(l,c),p=s(this._hash),m&&(p=x(p)),this.reset(),p},_.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},_.ArrayBuffer.prototype.getState=function(){var m=_.prototype.getState.call(this);return m.buff=v(m.buff),m},_.ArrayBuffer.prototype.setState=function(m){return m.buff=d(m.buff,!0),_.prototype.setState.call(this,m)},_.ArrayBuffer.prototype.destroy=_.prototype.destroy,_.ArrayBuffer.prototype._finish=_.prototype._finish,_.ArrayBuffer.hash=function(m,y){var c=w(new Uint8Array(m)),l=s(c);return y?x(l):l},_})}(re)),re.exports}var Ct=St();const At=ht(Ct);var Y=function(){return Y=Object.assign||function(a){for(var r,e=1,o=arguments.length;e<o;e++){r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},Y.apply(this,arguments)},Ut=function(a,r,e,o){function n(t){return t instanceof e?t:new e(function(u){u(t)})}return new(e||(e=Promise))(function(t,u){function f(s){try{i(o.next(s))}catch(h){u(h)}}function w(s){try{i(o.throw(s))}catch(h){u(h)}}function i(s){s.done?t(s.value):n(s.value).then(f,w)}i((o=o.apply(a,r||[])).next())})},It=function(a,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,n,t,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(i){return function(s){return w([i,s])}}function w(i){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,n&&(t=i[0]&2?n.return:i[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,i[1])).done)return t;switch(n=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,n=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1],t=i;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(i);break}t[2]&&e.ops.pop(),e.trys.pop();continue}i=r.call(a,e)}catch(s){i=[6,s],n=0}finally{o=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},H=Math.pow(1024,2);function kt(a,r){var e=r*H;if(e>a.size)e=a.size;else for(;a.size>e*1e4;)e*=2;for(var o=[],n=Math.ceil(a.size/e),t=0;t<n;t++){var u=a.slice(e*t,t===n-1?a.size:e*(t+1));o.push(u)}return o}function Ot(a){return Object.keys(a).every(function(r){return r.indexOf("x-qn-meta-")===0})}function Rt(a){return Object.keys(a).every(function(r){return r.indexOf("x:")===0})}function Tt(a){return a.reduce(function(r,e){return r+e},0)}function Ft(a,r,e){try{localStorage.setItem(a,JSON.stringify(r))}catch{e.warn(new A(C.WriteCacheFailed,"setLocalFileInfo failed: "+a))}}function zt(a,r,e){var o=r==null?"_":"_key_"+r+"_";return"qiniu_js_sdk_upload_file_name_"+a+o+"size_"+e}function ge(a,r){try{localStorage.removeItem(a)}catch{r.warn(new A(C.RemoveCacheFailed,"removeLocalFileInfo failed. key: "+a))}}function Et(a,r){var e=null;try{e=localStorage.getItem(a)}catch{r.warn(new A(C.ReadCacheFailed,"getLocalFileInfo failed. key: "+a))}if(e==null)return null;var o=null;try{o=JSON.parse(e)}catch{ge(a,r),r.warn(new A(C.InvalidCacheData,"getLocalFileInfo failed to parse. key: "+a))}return o}function X(a){var r="UpToken "+a;return{Authorization:r}}function We(a){var r=X(a);return Y({"content-type":"application/octet-stream"},r)}function Je(a){var r=X(a);return Y({"content-type":"application/json"},r)}function Ze(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)return new window.ActiveXObject("Microsoft.XMLHTTP");throw new A(C.NotAvailableXMLHttpRequest,"the current environment does not support.")}function Lt(a){return Ut(this,void 0,void 0,function(){var r,e;return It(this,function(o){switch(o.label){case 0:return[4,qt(a)];case 1:return r=o.sent(),e=new At.ArrayBuffer,e.append(r),[2,e.end()]}})})}function qt(a){return new Promise(function(r,e){var o=new FileReader;o.onload=function(n){if(n.target){var t=n.target.result;r(t)}else e(new A(C.InvalidProgressEventTarget,"progress event target is undefined"))},o.onerror=function(){e(new A(C.FileReaderReadFailed,"fileReader read failed"))},o.readAsArrayBuffer(a)})}function z(a,r){return new Promise(function(e,o){var n=Ze();if(n.open(r.method,a),r.onCreate&&r.onCreate(n),r.headers){var t=r.headers;Object.keys(t).forEach(function(u){n.setRequestHeader(u,t[u])})}n.upload.addEventListener("progress",function(u){u.lengthComputable&&r.onProgress&&r.onProgress({loaded:u.loaded,total:u.total})}),n.onreadystatechange=function(){var u=n.responseText;if(n.readyState===4){var f=n.getResponseHeader("x-reqId")||"";if(n.status===0){o(new Ne("network error.",f));return}if(n.status!==200){var w="xhr request failed, code: "+n.status;u&&(w+=" response: "+u);var i=void 0;try{i=JSON.parse(u)}catch{}o(new $(n.status,f,w,i));return}try{e({data:JSON.parse(u),reqId:f})}catch(s){o(s)}}},n.send(r.body)})}function Bt(a){if(a&&a.match){var r=a.match(/(^https?)/);if(!r)return"";var e=r[1];return r=a.match(/^https?:\/\/([^:^/]*):(\d*)/),r?r[2]:e==="http"?"80":"443"}return""}function Pt(a){if(a&&a.match){var r=a.match(/^https?:\/\/([^:^/]*)/);return r?r[1]:""}return""}function W(a){if(!a)throw new A(C.InvalidToken,"invalid token.");var r=a.split(":");if(r.length===1)throw new A(C.InvalidToken,"invalid token segments.");var e=r.length>3?r[1]:r[0];if(!e)throw new A(C.InvalidToken,"missing assess key field.");var o=null;try{o=JSON.parse(Xe(r[r.length-1]))}catch{throw new A(C.InvalidToken,"token parse failed.")}if(o==null)throw new A(C.InvalidToken,"putPolicy is null.");if(o.scope==null)throw new A(C.InvalidToken,"scope field is null.");var n=o.scope.split(":")[0];if(!n)throw new A(C.InvalidToken,"resolve bucketName failed.");return{assessKey:e,bucketName:n,scope:o.scope}}function Mt(a){var r=window.URL||window.webkitURL||window.mozURL;return r.createObjectURL(a)}var F,q={z0:"z0",z1:"z1",z2:"z2",na0:"na0",as0:"as0",cnEast2:"cn-east-2"},Dt=(F={},F[q.z0]={srcUphost:["up.qiniup.com"],cdnUphost:["upload.qiniup.com"]},F[q.z1]={srcUphost:["up-z1.qiniup.com"],cdnUphost:["upload-z1.qiniup.com"]},F[q.z2]={srcUphost:["up-z2.qiniup.com"],cdnUphost:["upload-z2.qiniup.com"]},F[q.na0]={srcUphost:["up-na0.qiniup.com"],cdnUphost:["upload-na0.qiniup.com"]},F[q.as0]={srcUphost:["up-as0.qiniup.com"],cdnUphost:["upload-as0.qiniup.com"]},F[q.cnEast2]={srcUphost:["up-cn-east-2.qiniup.com"],cdnUphost:["upload-cn-east-2.qiniup.com"]},F),D={},ne,xe;function Ht(){if(xe)return ne;xe=1;function a(r,e){return Object.prototype.hasOwnProperty.call(r,e)}return ne=function(r,e,o,n){e=e||"&",o=o||"=";var t={};if(typeof r!="string"||r.length===0)return t;var u=/\+/g;r=r.split(e);var f=1e3;n&&typeof n.maxKeys=="number"&&(f=n.maxKeys);var w=r.length;f>0&&w>f&&(w=f);for(var i=0;i<w;++i){var s=r[i].replace(u,"%20"),h=s.indexOf(o),d,v,b,x;h>=0?(d=s.substr(0,h),v=s.substr(h+1)):(d=s,v=""),b=decodeURIComponent(d),x=decodeURIComponent(v),a(t,b)?Array.isArray(t[b])?t[b].push(x):t[b]=[t[b],x]:t[b]=x}return t},ne}var ie,Se;function jt(){if(Se)return ie;Se=1;var a=function(r){switch(typeof r){case"string":return r;case"boolean":return r?"true":"false";case"number":return isFinite(r)?r:"";default:return""}};return ie=function(r,e,o,n){return e=e||"&",o=o||"=",r===null&&(r=void 0),typeof r=="object"?Object.keys(r).map(function(t){var u=encodeURIComponent(a(t))+o;return Array.isArray(r[t])?r[t].map(function(f){return u+encodeURIComponent(a(f))}).join(e):u+encodeURIComponent(a(r[t]))}).filter(Boolean).join(e):n?encodeURIComponent(a(n))+o+encodeURIComponent(a(r)):""},ie}var Ce;function $t(){return Ce||(Ce=1,D.decode=D.parse=Ht(),D.encode=D.stringify=jt()),D}var Kt=$t(),P=function(){return P=Object.assign||function(a){for(var r,e=1,o=arguments.length;e<o;e++){r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},P.apply(this,arguments)},Ye=function(a,r,e,o){function n(t){return t instanceof e?t:new e(function(u){u(t)})}return new(e||(e=Promise))(function(t,u){function f(s){try{i(o.next(s))}catch(h){u(h)}}function w(s){try{i(o.throw(s))}catch(h){u(h)}}function i(s){s.done?t(s.value):n(s.value).then(f,w)}i((o=o.apply(a,r||[])).next())})},Qe=function(a,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,n,t,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(i){return function(s){return w([i,s])}}function w(i){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,n&&(t=i[0]&2?n.return:i[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,i[1])).done)return t;switch(n=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,n=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1],t=i;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(i);break}t[2]&&e.ops.pop(),e.trys.pop();continue}i=r.call(a,e)}catch(s){i=[6,s],n=0}finally{o=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};function et(a,r,e){return Ye(this,void 0,void 0,function(){var o,n;return Qe(this,function(t){return o=Kt.stringify({ak:a,bucket:r}),n=e+"://api.qiniu.com/v2/query?"+o,[2,z(n,{method:"GET"})]})})}function be(a,r,e){var o=e.url,n=e.id;return o+"/buckets/"+a+"/objects/"+(r!=null?B(r):"~")+"/uploads/"+n}function Gt(a,r,e,o){var n=o+"/buckets/"+r+"/objects/"+(e!=null?B(e):"~")+"/uploads";return z(n,{method:"POST",headers:X(a)})}function Vt(a,r,e,o,n){var t=W(a).bucketName,u=be(t,r,o)+("/"+e),f=We(a);return n.md5&&(f["Content-MD5"]=n.md5),z(u,P(P({},n),{method:"PUT",headers:f}))}function Nt(a,r,e,o){var n=W(a).bucketName,t=be(n,r,e);return z(t,P(P({},o),{method:"POST",headers:Je(a)}))}function Xt(a,r,e){var o=W(a).bucketName,n=be(o,r,e);return z(n,{method:"DELETE",headers:X(a)})}function Wt(a,r,e){return z(a,P({method:"POST",body:r},e))}function Jt(a,r){return Ye(this,void 0,void 0,function(){var e,o,n,t,u;return Qe(this,function(f){switch(f.label){case 0:return e=it(a),o=e.upprotocol,e.uphost.length>0?[2,o+"://"+e.uphost[0]]:(n=W(r),[4,et(n.assessKey,n.bucketName,o)]);case 1:return t=f.sent(),u=t.data.up.acc.main,[2,o+"://"+u[0]]}})})}var Q=function(){return Q=Object.assign||function(a){for(var r,e=1,o=arguments.length;e<o;e++){r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},Q.apply(this,arguments)},Ae=function(a,r,e,o){function n(t){return t instanceof e?t:new e(function(u){u(t)})}return new(e||(e=Promise))(function(t,u){function f(s){try{i(o.next(s))}catch(h){u(h)}}function w(s){try{i(o.throw(s))}catch(h){u(h)}}function i(s){s.done?t(s.value):n(s.value).then(f,w)}i((o=o.apply(a,r||[])).next())})},Ue=function(a,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,n,t,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(i){return function(s){return w([i,s])}}function w(i){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,n&&(t=i[0]&2?n.return:i[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,i[1])).done)return t;switch(n=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,n=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1],t=i;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(i);break}t[2]&&e.ops.pop(),e.trys.pop();continue}i=r.call(a,e)}catch(s){i=[6,s],n=0}finally{o=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Zt=function(a,r){var e=typeof Symbol=="function"&&a[Symbol.iterator];if(!e)return a;var o=e.call(a),n,t=[],u;try{for(;(r===void 0||r-- >0)&&!(n=o.next()).done;)t.push(n.value)}catch(f){u={error:f}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(u)throw u.error}}return t},Yt=function(){for(var a=[],r=0;r<arguments.length;r++)a=a.concat(Zt(arguments[r]));return a},Qt=4,tt=[0,502,503,504,599],er=Yt(tt,[406]),tr=Math.pow(1024,3),rt=function(){function a(r,e,o,n){this.hostPool=o,this.logger=n,this.aborted=!1,this.retryCount=0,this.xhrList=[],this.config=r.config,n.info("config inited.",this.config),this.putExtra=Q({fname:""},r.putExtra),n.info("putExtra inited.",this.putExtra),this.key=r.key,this.file=r.file,this.token=r.token,this.onData=e.onData,this.onError=e.onError,this.onComplete=e.onComplete;try{var t=W(this.token);this.bucketName=t.bucketName,this.assessKey=t.assessKey}catch(u){n.error("get putPolicy from token failed.",u),this.onError(u)}}return a.prototype.checkAndUpdateUploadHost=function(){return Ae(this,void 0,void 0,function(){var r;return Ue(this,function(e){switch(e.label){case 0:return this.logger.info("get available upload host."),[4,this.hostPool.getUp(this.assessKey,this.bucketName,this.config.upprotocol)];case 1:if(r=e.sent(),r==null)throw new A(C.NotAvailableUploadHost,"no available upload host.");return this.uploadHost!=null&&this.uploadHost.host!==r.host?this.logger.warn("host switches from "+this.uploadHost.host+" to "+r.host+"."):this.logger.info("use host "+r.host+"."),this.uploadHost=r,[2]}})})},a.prototype.checkAndUnfreezeHost=function(){this.logger.info("check unfreeze host."),this.uploadHost!=null&&this.uploadHost.isFrozen()&&(this.logger.warn(this.uploadHost.host+" will be unfrozen."),this.uploadHost.unfreeze())},a.prototype.checkAndFreezeHost=function(r){this.logger.info("check freeze host."),r instanceof $&&this.uploadHost!=null&&tt.includes(r.code)&&(this.logger.warn(this.uploadHost.host+" will be temporarily frozen."),this.uploadHost.freeze())},a.prototype.handleError=function(r){this.logger.error(r.message),this.onError(r)},a.prototype.putFile=function(){return Ae(this,void 0,void 0,function(){var r,e,o,n;return Ue(this,function(t){switch(t.label){case 0:if(this.aborted=!1,this.putExtra.fname||(this.logger.info("use file.name as fname."),this.putExtra.fname=this.file.name),this.file.size>1e4*tr)return this.handleError(new A(C.InvalidFile,"file size exceed maximum value 10000G")),[2];if(this.putExtra.customVars&&!Rt(this.putExtra.customVars))return this.handleError(new A(C.InvalidCustomVars,"customVars key should start width x:")),[2];if(this.putExtra.metadata&&!Ot(this.putExtra.metadata))return this.handleError(new A(C.InvalidMetadata,"metadata key should start with x-qn-meta-")),[2];t.label=1;case 1:return t.trys.push([1,4,,5]),this.uploadAt=new Date().getTime(),[4,this.checkAndUpdateUploadHost()];case 2:return t.sent(),[4,this.run()];case 3:return r=t.sent(),this.onComplete(r.data),this.checkAndUnfreezeHost(),this.sendLog(r.reqId,200),[2];case 4:return e=t.sent(),this.aborted?(this.logger.warn("upload is aborted."),this.sendLog("",-2),[2]):(this.clear(),this.logger.error(e),e instanceof $&&(this.sendLog(e.reqId,e.code),this.checkAndFreezeHost(e),o=++this.retryCount<=this.config.retryCount,n=er.includes(e.code),n&&o)?(this.logger.warn("error auto retry: "+this.retryCount+"/"+this.config.retryCount+"."),this.putFile(),[2]):(this.onError(e),[3,5]));case 5:return[2]}})})},a.prototype.clear=function(){this.xhrList.forEach(function(r){r.onreadystatechange=null,r.abort()}),this.xhrList=[],this.logger.info("cleanup uploading xhr.")},a.prototype.stop=function(){this.logger.info("aborted."),this.clear(),this.aborted=!0},a.prototype.addXhr=function(r){this.xhrList.push(r)},a.prototype.sendLog=function(r,e){var o,n;this.logger.report({code:e,reqId:r,remoteIp:"",upType:"jssdk-h5",size:this.file.size,time:Math.floor(this.uploadAt/1e3),port:Bt((o=this.uploadHost)===null||o===void 0?void 0:o.getUrl()),host:Pt((n=this.uploadHost)===null||n===void 0?void 0:n.getUrl()),bytesSent:this.progress?this.progress.total.loaded:0,duration:Math.floor((new Date().getTime()-this.uploadAt)/1e3)})},a.prototype.getProgressInfoItem=function(r,e,o){return Q({size:e,loaded:r,percent:r/e*100},o==null?{}:{fromCache:o})},a}(),rr=function(){var a=function(r,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var t in n)n.hasOwnProperty(t)&&(o[t]=n[t])},a(r,e)};return function(r,e){a(r,e);function o(){this.constructor=r}r.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),N=function(){return N=Object.assign||function(a){for(var r,e=1,o=arguments.length;e<o;e++){r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},N.apply(this,arguments)},K=function(a,r,e,o){function n(t){return t instanceof e?t:new e(function(u){u(t)})}return new(e||(e=Promise))(function(t,u){function f(s){try{i(o.next(s))}catch(h){u(h)}}function w(s){try{i(o.throw(s))}catch(h){u(h)}}function i(s){s.done?t(s.value):n(s.value).then(f,w)}i((o=o.apply(a,r||[])).next())})},G=function(a,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,n,t,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(i){return function(s){return w([i,s])}}function w(i){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,n&&(t=i[0]&2?n.return:i[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,i[1])).done)return t;switch(n=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,n=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1],t=i;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(i);break}t[2]&&e.ops.pop(),e.trys.pop();continue}i=r.call(a,e)}catch(s){i=[6,s],n=0}finally{o=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};function nr(a){var r=/^[1-9]\d*$/;return r.test(String(a))}var ir=function(a){rr(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.run=function(){return K(this,void 0,void 0,function(){var e,o,n,t,u,f=this;return G(this,function(w){switch(w.label){case 0:if(this.logger.info("start run Resume."),!this.config.chunkSize||!nr(this.config.chunkSize))throw new A(C.InvalidChunkSize,"chunkSize must be a positive integer");if(this.config.chunkSize>1024)throw new A(C.InvalidChunkSize,"chunkSize maximum value is 1024");return[4,this.initBeforeUploadChunks()];case 1:w.sent(),e=new pt(function(i){return K(f,void 0,void 0,function(){return G(this,function(s){switch(s.label){case 0:if(this.aborted)throw e.abort(),new Error("pool is aborted");return[4,this.uploadChunk(i)];case 1:return s.sent(),[2]}})})},this.config.concurrentRequestLimit),o=null,n=this.getLocalKey(),t=this.chunks.map(function(i,s){return e.enqueue({chunk:i,index:s})}),w.label=2;case 2:return w.trys.push([2,5,,6]),[4,Promise.all(t)];case 3:return w.sent(),[4,this.mkFileReq()];case 4:return o=w.sent(),[3,6];case 5:throw u=w.sent(),u instanceof $&&(u.code===612||u.code===400)&&ge(n,this.logger),u;case 6:return ge(n,this.logger),[2,o]}})})},r.prototype.uploadChunk=function(e){return K(this,void 0,void 0,function(){var o,n,t,u,f,w,i,s,h,d=this;return G(this,function(v){switch(v.label){case 0:return o=e.index,n=e.chunk,t=this.cachedUploadedList[o],this.logger.info("upload part "+o+", cache:",t),u=this.config.checkByMD5,f=function(){d.usedCacheList[o]=!0,d.updateChunkProgress(n.size,o),d.uploadedList[o]=t,d.updateLocalCache()},t&&!u?(f(),[2]):[4,Lt(n)];case 1:return w=v.sent(),this.logger.info("computed part md5.",w),t&&w===t.md5?(f(),[2]):(this.usedCacheList[o]=!1,i=function(b){d.updateChunkProgress(b.loaded,o)},s={body:n,md5:this.config.checkByServer?w:void 0,onProgress:i,onCreate:function(b){return d.addXhr(b)}},this.logger.info("part "+o+" start uploading."),[4,Vt(this.token,this.key,e.index+1,this.getUploadInfo(),s)]);case 2:return h=v.sent(),this.logger.info("part "+o+" upload completed."),i({loaded:n.size,total:n.size}),this.uploadedList[o]={etag:h.data.etag,md5:h.data.md5,size:n.size},this.updateLocalCache(),[2]}})})},r.prototype.mkFileReq=function(){return K(this,void 0,void 0,function(){var e,o,n=this;return G(this,function(t){switch(t.label){case 0:return e=N(N(N({parts:this.uploadedList.map(function(u,f){return{etag:u.etag,partNumber:f+1}}),fname:this.putExtra.fname},this.putExtra.mimeType&&{mimeType:this.putExtra.mimeType}),this.putExtra.customVars&&{customVars:this.putExtra.customVars}),this.putExtra.metadata&&{metadata:this.putExtra.metadata}),this.logger.info("parts upload completed, make file.",e),[4,Nt(this.token,this.key,this.getUploadInfo(),{onCreate:function(u){return n.addXhr(u)},body:JSON.stringify(e)})];case 1:return o=t.sent(),this.logger.info("finish Resume Progress."),this.updateMkFileProgress(1),[2,o]}})})},r.prototype.initBeforeUploadChunks=function(){return K(this,void 0,void 0,function(){var e,o,n;return G(this,function(t){switch(t.label){case 0:return this.uploadedList=[],this.usedCacheList=[],e=Et(this.getLocalKey(),this.logger),e?[3,2]:(this.logger.info("init upload parts from api."),[4,Gt(this.token,this.bucketName,this.key,this.uploadHost.getUrl())]);case 1:return o=t.sent(),this.logger.info("initd upload parts of id: "+o.data.uploadId+"."),this.uploadId=o.data.uploadId,this.cachedUploadedList=[],[3,3];case 2:n=["resume upload parts from local cache,","total "+e.data.length+" part,","id is "+e.id+"."],this.logger.info(n.join(" ")),this.cachedUploadedList=e.data,this.uploadId=e.id,t.label=3;case 3:return this.chunks=kt(this.file,this.config.chunkSize),this.loaded={mkFileProgress:0,chunks:this.chunks.map(function(u){return 0})},this.notifyResumeProgress(),[2]}})})},r.prototype.getUploadInfo=function(){return{id:this.uploadId,url:this.uploadHost.getUrl()}},r.prototype.getLocalKey=function(){return zt(this.file.name,this.key,this.file.size)},r.prototype.updateLocalCache=function(){Ft(this.getLocalKey(),{id:this.uploadId,data:this.uploadedList},this.logger)},r.prototype.updateChunkProgress=function(e,o){this.loaded.chunks[o]=e,this.notifyResumeProgress()},r.prototype.updateMkFileProgress=function(e){this.loaded.mkFileProgress=e,this.notifyResumeProgress()},r.prototype.notifyResumeProgress=function(){var e=this;this.progress={total:this.getProgressInfoItem(Tt(this.loaded.chunks)+this.loaded.mkFileProgress,this.file.size+1),chunks:this.chunks.map(function(o,n){var t=e.usedCacheList[n];return e.getProgressInfoItem(e.loaded.chunks[n],o.size,t)}),uploadInfo:{id:this.uploadId,url:this.uploadHost.getUrl()}},this.onData(this.progress)},r}(rt),Ie=function(a,r,e,o){function n(t){return t instanceof e?t:new e(function(u){u(t)})}return new(e||(e=Promise))(function(t,u){function f(s){try{i(o.next(s))}catch(h){u(h)}}function w(s){try{i(o.throw(s))}catch(h){u(h)}}function i(s){s.done?t(s.value):n(s.value).then(f,w)}i((o=o.apply(a,r||[])).next())})},ke=function(a,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,n,t,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(i){return function(s){return w([i,s])}}function w(i){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,n&&(t=i[0]&2?n.return:i[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,i[1])).done)return t;switch(n=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,n=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1],t=i;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(i);break}t[2]&&e.ops.pop(),e.trys.pop();continue}i=r.call(a,e)}catch(s){i=[6,s],n=0}finally{o=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},or=function(){function a(){this.crc=-1,this.table=this.makeTable()}return a.prototype.makeTable=function(){for(var r=new Array,e=0;e<256;e++){for(var o=e,n=0;n<8;n++)o&1?o=o>>>1^3988292384:o>>>=1;r[e]=o}return r},a.prototype.append=function(r){for(var e=this.crc,o=0;o<r.byteLength;o++)e=e>>>8^this.table[(e^r[o])&255];this.crc=e},a.prototype.compute=function(){return(this.crc^-1)>>>0},a.prototype.readAsUint8Array=function(r){return Ie(this,void 0,void 0,function(){var e;return ke(this,function(o){switch(o.label){case 0:return typeof r.arrayBuffer!="function"?[3,2]:(e=Uint8Array.bind,[4,r.arrayBuffer()]);case 1:return[2,new(e.apply(Uint8Array,[void 0,o.sent()]))];case 2:return[2,new Promise(function(n,t){var u=new FileReader;u.onload=function(){if(u.result==null){t();return}if(typeof u.result=="string"){t();return}n(new Uint8Array(u.result))},u.readAsArrayBuffer(r)})]}})})},a.prototype.file=function(r){return Ie(this,void 0,void 0,function(){var e,o,n,t,u,f;return ke(this,function(w){switch(w.label){case 0:return r.size<=H?(e=this.append,[4,this.readAsUint8Array(r)]):[3,2];case 1:return e.apply(this,[w.sent()]),[2,this.compute()];case 2:o=Math.ceil(r.size/H),n=0,w.label=3;case 3:return n<o?(t=n*H,u=n===o-1?r.size:t+H,[4,this.readAsUint8Array(r.slice(t,u))]):[3,6];case 4:f=w.sent(),this.append(new Uint8Array(f)),w.label=5;case 5:return n++,[3,3];case 6:return[2,this.compute()]}})})},a.file=function(r){var e=new a;return e.file(r)},a}(),ar=function(){var a=function(r,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var t in n)n.hasOwnProperty(t)&&(o[t]=n[t])},a(r,e)};return function(r,e){a(r,e);function o(){this.constructor=r}r.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),sr=function(a,r,e,o){function n(t){return t instanceof e?t:new e(function(u){u(t)})}return new(e||(e=Promise))(function(t,u){function f(s){try{i(o.next(s))}catch(h){u(h)}}function w(s){try{i(o.throw(s))}catch(h){u(h)}}function i(s){s.done?t(s.value):n(s.value).then(f,w)}i((o=o.apply(a,r||[])).next())})},ur=function(a,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,n,t,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(i){return function(s){return w([i,s])}}function w(i){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,n&&(t=i[0]&2?n.return:i[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,i[1])).done)return t;switch(n=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,n=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1],t=i;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(i);break}t[2]&&e.ops.pop(),e.trys.pop();continue}i=r.call(a,e)}catch(s){i=[6,s],n=0}finally{o=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Oe=function(a){ar(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.run=function(){return sr(this,void 0,void 0,function(){var e,o,n,t,u,f=this;return ur(this,function(w){switch(w.label){case 0:return this.logger.info("start run Direct."),e=new FormData,e.append("file",this.file),e.append("token",this.token),this.key!=null&&e.append("key",this.key),e.append("fname",this.putExtra.fname),this.config.checkByServer?[4,or.file(this.file)]:[3,2];case 1:o=w.sent(),e.append("crc32",o.toString()),w.label=2;case 2:return this.putExtra.customVars&&(this.logger.info("init customVars."),n=this.putExtra.customVars,Object.keys(n).forEach(function(i){return e.append(i,n[i].toString())}),this.logger.info("customVars inited.")),this.putExtra.metadata&&(this.logger.info("init metadata."),t=this.putExtra.metadata,Object.keys(t).forEach(function(i){return e.append(i,t[i].toString())})),this.logger.info("formData inited."),[4,Wt(this.uploadHost.getUrl(),e,{onProgress:function(i){f.updateDirectProgress(i.loaded,i.total)},onCreate:function(i){return f.addXhr(i)}})];case 3:return u=w.sent(),this.logger.info("Direct progress finish."),this.finishDirectProgress(),[2,u]}})})},r.prototype.updateDirectProgress=function(e,o){this.progress={total:this.getProgressInfoItem(e,o+1)},this.onData(this.progress)},r.prototype.finishDirectProgress=function(){if(!this.progress){this.logger.warn("progress is null."),this.progress={total:this.getProgressInfoItem(this.file.size,this.file.size)},this.onData(this.progress);return}var e=this.progress.total;this.progress={total:this.getProgressInfoItem(e.loaded+1,e.size)},this.onData(this.progress)},r}(rt);function nt(a,r,e){e===void 0&&(e=3);var o=Ze();o.open("POST","https://uplog.qbox.me/log/3"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("Authorization",X(a).Authorization),o.onreadystatechange=function(){o.readyState===4&&o.status!==200&&e>0&&nt(a,r,e-1)};var n=[r.code||"",r.reqId||"",r.host||"",r.remoteIp||"",r.port||"",r.duration||"",r.time||"",r.bytesSent||"",r.upType||"",r.size||""].join(",");o.send(n)}var fr=function(a,r){var e=typeof Symbol=="function"&&a[Symbol.iterator];if(!e)return a;var o=e.call(a),n,t=[],u;try{for(;(r===void 0||r-- >0)&&!(n=o.next()).done;)t.push(n.value)}catch(f){u={error:f}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(u)throw u.error}}return t},oe=function(){for(var a=[],r=0;r<arguments.length;r++)a=a.concat(fr(arguments[r]));return a},cr=function(){function a(r,e,o,n){e===void 0&&(e=!0),o===void 0&&(o="OFF"),n===void 0&&(n="UPLOAD"),this.token=r,this.disableReport=e,this.level=o,this.prefix=n,this.id=++a.id}return a.prototype.getPrintPrefix=function(r){return"Qiniu-JS-SDK ["+r+"]["+this.prefix+"#"+this.id+"]:"},a.prototype.report=function(r,e){if(!this.disableReport)try{nt(this.token,r,e)}catch(o){this.warn(o)}},a.prototype.info=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var o=["INFO"];o.includes(this.level)&&console.log.apply(console,oe([this.getPrintPrefix("INFO")],r))},a.prototype.warn=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var o=["INFO","WARN"];o.includes(this.level)&&console.warn.apply(console,oe([this.getPrintPrefix("WARN")],r))},a.prototype.error=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var o=["INFO","WARN","ERROR"];o.includes(this.level)&&console.error.apply(console,oe([this.getPrintPrefix("ERROR")],r))},a.id=0,a}(),Re=function(a,r,e,o){function n(t){return t instanceof e?t:new e(function(u){u(t)})}return new(e||(e=Promise))(function(t,u){function f(s){try{i(o.next(s))}catch(h){u(h)}}function w(s){try{i(o.throw(s))}catch(h){u(h)}}function i(s){s.done?t(s.value):n(s.value).then(f,w)}i((o=o.apply(a,r||[])).next())})},Te=function(a,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,n,t,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(i){return function(s){return w([i,s])}}function w(i){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,n&&(t=i[0]&2?n.return:i[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,i[1])).done)return t;switch(n=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,n=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1],t=i;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(i);break}t[2]&&e.ops.pop(),e.trys.pop();continue}i=r.call(a,e)}catch(s){i=[6,s],n=0}finally{o=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},lr=function(a,r){var e=typeof Symbol=="function"&&a[Symbol.iterator];if(!e)return a;var o=e.call(a),n,t=[],u;try{for(;(r===void 0||r-- >0)&&!(n=o.next()).done;)t.push(n.value)}catch(f){u={error:f}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(u)throw u.error}}return t},hr=function(){for(var a=[],r=0;r<arguments.length;r++)a=a.concat(lr(arguments[r]));return a},Z=new Map,dr=function(){function a(r,e){this.host=r,this.protocol=e}return a.prototype.isFrozen=function(){var r=new Date().getTime(),e=Z.get(this.host);return e!=null&&e>=r},a.prototype.freeze=function(r){r===void 0&&(r=20);var e=new Date().getTime()+r*1e3;Z.set(this.host,e)},a.prototype.unfreeze=function(){Z.delete(this.host)},a.prototype.getUrl=function(){return this.protocol+"://"+this.host},a.prototype.getUnfreezeTime=function(){return Z.get(this.host)},a}(),pr=function(){function a(r){r===void 0&&(r=[]),this.initHosts=r,this.cachedHostsMap=new Map}return a.prototype.register=function(r,e,o,n){this.cachedHostsMap.set(r+"@"+e,o.map(function(t){return new dr(t,n)}))},a.prototype.refresh=function(r,e,o){var n,t,u,f;return Re(this,void 0,void 0,function(){var w,i,s;return Te(this,function(h){switch(h.label){case 0:return w=this.cachedHostsMap.get(r+"@"+e)||[],w.length>0?[2]:this.initHosts.length>0?(this.register(r,e,this.initHosts,o),[2]):[4,et(r,e,o)];case 1:return i=h.sent(),(i==null?void 0:i.data)!=null&&(s=hr(((t=(n=i.data.up)===null||n===void 0?void 0:n.acc)===null||t===void 0?void 0:t.main)||[],((f=(u=i.data.up)===null||u===void 0?void 0:u.acc)===null||f===void 0?void 0:f.backup)||[]),this.register(r,e,s,o)),[2]}})})},a.prototype.getUp=function(r,e,o){return Re(this,void 0,void 0,function(){var n,t,u;return Te(this,function(f){switch(f.label){case 0:return[4,this.refresh(r,e,o)];case 1:return f.sent(),n=this.cachedHostsMap.get(r+"@"+e)||[],n.length===0?[2,null]:(t=n.filter(function(w){return!w.isFrozen()}),t.length>0?[2,t[0]]:(u=n.slice().sort(function(w,i){return(w.getUnfreezeTime()||0)-(i.getUnfreezeTime()||0)}),[2,u[0]]))}})})},a}();function vr(a,r,e,o){return a.config&&a.config.forceDirect?(o.info("ues forceDirect mode."),new Oe(a,r,e,o)):a.file.size>4*H?(o.info("file size over 4M, use Resume."),new ir(a,r,e,o)):(o.info("file size less or equal than 4M, use Direct."),new Oe(a,r,e,o))}function yr(a,r,e,o,n){var t=new cr(e,n==null?void 0:n.disableStatisticsReport,n==null?void 0:n.debugLogLevel,a.name),u={file:a,key:r,token:e,putExtra:o,config:it(n,t)},f=new pr(u.config.uphost);return new mt(function(w){var i=vr(u,{onData:function(s){return w.next(s)},onError:function(s){return w.error(s)},onComplete:function(s){return w.complete(s)}},f,t);return i.putFile(),i.stop.bind(i)})}var j=function(){return j=Object.assign||function(a){for(var r,e=1,o=arguments.length;e<o;e++){r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},j.apply(this,arguments)},gr=function(a,r){var e={};for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&r.indexOf(o)<0&&(e[o]=a[o]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(a);n<o.length;n++)r.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(a,o[n])&&(e[o[n]]=a[o[n]]);return e},mr=function(a,r){var e=typeof Symbol=="function"&&a[Symbol.iterator];if(!e)return a;var o=e.call(a),n,t=[],u;try{for(;(r===void 0||r-- >0)&&!(n=o.next()).done;)t.push(n.value)}catch(f){u={error:f}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(u)throw u.error}}return t},ae=function(){for(var a=[],r=0;r<arguments.length;r++)a=a.concat(mr(arguments[r]));return a};function it(a,r){var e=j({},a),o=e.upprotocol,n=e.uphost,t=gr(e,["upprotocol","uphost"]),u=j({uphost:[],retryCount:3,checkByMD5:!1,forceDirect:!1,useCdnDomain:!0,checkByServer:!0,concurrentRequestLimit:3,chunkSize:Qt,upprotocol:"https",debugLogLevel:"OFF",disableStatisticsReport:!1},t);o&&(u.upprotocol=o.replace(/:$/,""));var f=[];if(r&&(a==null?void 0:a.uphost)!=null&&(a==null?void 0:a.region)!=null&&r.warn("do not use both the uphost and region config."),n)Array.isArray(n)?f.push.apply(f,ae(n)):f.push(n);else if(u!=null&&u.region){var w=Dt[u==null?void 0:u.region];u.useCdnDomain?f.push.apply(f,ae(w.cdnUphost)):f.push.apply(f,ae(w.srcUphost))}return j(j({},u),{uphost:f.filter(Boolean)})}var me=function(){return me=Object.assign||function(a){for(var r,e=1,o=arguments.length;e<o;e++){r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},me.apply(this,arguments)},Fe=function(a,r,e,o){function n(t){return t instanceof e?t:new e(function(u){u(t)})}return new(e||(e=Promise))(function(t,u){function f(s){try{i(o.next(s))}catch(h){u(h)}}function w(s){try{i(o.throw(s))}catch(h){u(h)}}function i(s){s.done?t(s.value):n(s.value).then(f,w)}i((o=o.apply(a,[])).next())})},ze=function(a,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,n,t,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(i){return function(s){return w([i,s])}}function w(i){if(o)throw new TypeError("Generator is already executing.");for(;e;)try{if(o=1,n&&(t=i[0]&2?n.return:i[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,i[1])).done)return t;switch(n=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,n=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1],t=i;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(i);break}t[2]&&e.ops.pop(),e.trys.pop();continue}i=r.call(a,e)}catch(s){i=[6,s],n=0}finally{o=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},we={PNG:"image/png",JPEG:"image/jpeg",WEBP:"image/webp",BMP:"image/bmp"},wr=4,br=Math.log(2),_r=Object.keys(we).map(function(a){return we[a]}),xr=we.JPEG;function Sr(a){return _r.includes(a)}var Cr=function(){function a(r,e){this.file=r,this.config=e,this.config=me({quality:.92,noCompressIfLarger:!1},this.config)}return a.prototype.process=function(){return Fe(this,void 0,void 0,function(){var r,e,o,n,t,u;return ze(this,function(f){switch(f.label){case 0:if(this.outputType=this.file.type,r={},!Sr(this.file.type))throw new A(C.UnsupportedFileType,"unsupported file type: "+this.file.type);return[4,this.getOriginImage()];case 1:return e=f.sent(),[4,this.getCanvas(e)];case 2:return o=f.sent(),n=1,this.config.maxWidth&&(n=Math.min(1,this.config.maxWidth/o.width)),this.config.maxHeight&&(n=Math.min(1,n,this.config.maxHeight/o.height)),r.width=o.width,r.height=o.height,[4,this.doScale(o,n)];case 3:return t=f.sent(),u=this.toBlob(t),u.size>this.file.size&&this.config.noCompressIfLarger?[2,{dist:this.file,width:r.width,height:r.height}]:[2,{dist:u,width:t.width,height:t.height}]}})})},a.prototype.clear=function(r,e,o){this.outputType===xr?(r.fillStyle="#fff",r.fillRect(0,0,e,o)):r.clearRect(0,0,e,o)},a.prototype.getOriginImage=function(){var r=this;return new Promise(function(e,o){var n=Mt(r.file),t=new Image;t.onload=function(){e(t)},t.onerror=function(){o("image load error")},t.src=n})},a.prototype.getCanvas=function(r){var e=this;return new Promise(function(o,n){var t=document.createElement("canvas"),u=t.getContext("2d");if(!u){n(new A(C.GetCanvasContextFailed,"context is null"));return}var f=r.width,w=r.height;t.height=w,t.width=f,e.clear(u,f,w),u.drawImage(r,0,0),o(t)})},a.prototype.doScale=function(r,e){return Fe(this,void 0,void 0,function(){var o,n,t,u,f,w,i,s,h,d,v,b,x,_,m,y;return ze(this,function(c){if(e===1)return[2,r];if(o=r.getContext("2d"),n=Math.min(wr,Math.ceil(1/e/br)),t=Math.pow(e,1/n),u=document.createElement("canvas"),f=u.getContext("2d"),w=r.width,i=r.height,s=w,h=i,u.width=w,u.height=i,!f||!o)throw new A(C.GetCanvasContextFailed,"mctx or sctx can't be null");for(b=0;b<n;b++)x=w*t|0,_=i*t|0,b===n-1&&(x=s*e,_=h*e),b%2===0?(d=r,v=f):(d=u,v=o),this.clear(v,w,i),v.drawImage(d,0,0,w,i,0,0,x,_),w=x,i=_;return m=d===r?u:r,y=v.getImageData(0,0,w,i),m.width=w,m.height=i,v.putImageData(y,0,0),[2,m]})})},a.prototype.toBlob=function(r){var e=r.toDataURL(this.outputType,this.config.quality),o=atob(e.split(",")[1]).split("").map(function(t){return t.charCodeAt(0)}),n=new Blob([new Uint8Array(o)],{type:this.outputType});return n},a}(),Ar=function(a,r){return new Cr(a,r).process()};function J(a,r){return a=encodeURIComponent(a),r.slice(r.length-1)!=="/"&&(r+="/"),r+a}function Ur(a,r,e){if(!/^\d$/.test(String(a.mode)))throw"mode should be number in imageView2";var o=a.mode,n=a.w,t=a.h,u=a.q,f=a.format;if(!n&&!t)throw"param w and h is empty in imageView2";var w="imageView2/"+encodeURIComponent(o);return w+=n?"/w/"+encodeURIComponent(n):"",w+=t?"/h/"+encodeURIComponent(t):"",w+=u?"/q/"+encodeURIComponent(u):"",w+=f?"/format/"+encodeURIComponent(f):"",w}function ot(a,r,e){var o=a["auto-orient"],n=a.thumbnail,t=a.strip,u=a.gravity,f=a.crop,w=a.quality,i=a.rotate,s=a.format,h=a.blur,d="imageMogr2";return d+=o?"/auto-orient":"",d+=n?"/thumbnail/"+encodeURIComponent(n):"",d+=t?"/strip":"",d+=u?"/gravity/"+encodeURIComponent(u):"",d+=w?"/quality/"+encodeURIComponent(w):"",d+=f?"/crop/"+encodeURIComponent(f):"",d+=i?"/rotate/"+encodeURIComponent(i):"",d+=s?"/format/"+encodeURIComponent(s):"",d+=h?"/blur/"+encodeURIComponent(h):"",r&&e&&(d=J(r,e)+"?"+d),d}function at(a,r,e){var o=a.mode;if(!o)throw"mode can't be empty in watermark";var n="watermark/"+o;if(o!==1&&o!==2)throw"mode is wrong";if(o===1){var t=a.image;if(!t)throw"image can't be empty in watermark";n+=t?"/image/"+B(t):""}if(o===2){var u=a.text,f=a.font,w=a.fontsize,i=a.fill;if(!u)throw"text can't be empty in watermark";n+=u?"/text/"+B(u):"",n+=f?"/font/"+B(f):"",n+=w?"/fontsize/"+w:"",n+=i?"/fill/"+B(i):""}var s=a.dissolve,h=a.gravity,d=a.dx,v=a.dy;return n+=s?"/dissolve/"+encodeURIComponent(s):"",n+=h?"/gravity/"+encodeURIComponent(h):"",n+=d?"/dx/"+encodeURIComponent(d):"",n+=v?"/dy/"+encodeURIComponent(v):"",r&&e&&(n=J(r,e)+"?"+n),n}function Ir(a,r){var e=J(a,r)+"?imageInfo";return z(e,{method:"GET"})}function kr(a,r){var e=J(a,r)+"?exif";return z(e,{method:"GET"})}function Or(a,r,e){var o=Object.prototype.toString.call(a)==="[object Array]",n,t=!1,u="";if(o){for(var f=0,w=a.length;f<w;f++){if(n=a[f],!n.fop)throw"fop can't be empty in pipeline";switch(n.fop){case"watermark":u+=at(n)+"|";break;case"imageView2":u+=Ur(n)+"|";break;case"imageMogr2":u+=ot(n)+"|";break;default:t=!0;break}if(t)throw"fop is wrong in pipeline"}if(r&&e){u=J(r,e)+"?"+u;var i=u.length;u.slice(i-1)==="|"&&(u=u.slice(0,i-1))}return u}throw"pipeline's first param should be array"}const Dr=Object.freeze(Object.defineProperty({__proto__:null,QiniuError:A,get QiniuErrorName(){return C},QiniuNetworkError:Ne,QiniuRequestError:$,compressImage:Ar,deleteUploadedChunks:Xt,exif:kr,getHeadersForChunkUpload:We,getHeadersForMkFile:Je,getUploadUrl:Jt,imageInfo:Ir,imageMogr2:ot,pipeline:Or,region:q,upload:yr,urlSafeBase64Decode:Xe,urlSafeBase64Encode:B,watermark:at},Symbol.toStringTag,{value:"Module"}));var se={},ue={exports:{}},Ee;function st(){return Ee||(Ee=1,function(a){function r(e){return e&&e.__esModule?e:{default:e}}a.exports=r,a.exports.__esModule=!0,a.exports.default=a.exports}(ue)),ue.exports}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var fe,Le;function Rr(){if(Le)return fe;Le=1;var a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,e=Object.prototype.propertyIsEnumerable;function o(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function n(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var u={},f=0;f<10;f++)u["_"+String.fromCharCode(f)]=f;var w=Object.getOwnPropertyNames(u).map(function(s){return u[s]});if(w.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(s){i[s]=s}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return fe=n()?Object.assign:function(t,u){for(var f,w=o(t),i,s=1;s<arguments.length;s++){f=Object(arguments[s]);for(var h in f)r.call(f,h)&&(w[h]=f[h]);if(a){i=a(f);for(var d=0;d<i.length;d++)e.call(f,i[d])&&(w[i[d]]=f[i[d]])}}return w},fe}var ce={},qe;function Tr(){return qe||(qe=1,function(a){a.__esModule=!0,a.default=r;function r(e,o){return o===void 0&&(o={}),new Promise(function(n,t){var u=o,f=u.async,w=f===void 0?!0:f,i=u.data,s=i===void 0?null:i,h=u.headers,d=h===void 0?{}:h,v=u.method,b=v===void 0?"get":v,x=u.timeout,_=x===void 0?0:x,m=u.onprogress,y=new XMLHttpRequest,c;_&&(c=setTimeout(function(){t(new Error("the request timeout "+_+"ms"))},_)),y.onerror=function(){t(new Error("unknown error"))},y.upload&&(y.upload.onprogress=m),y.onreadystatechange=function(){if(y.readyState===4)if(_&&clearTimeout(c),y.status>=200&&y.status<300)n(y.response,y);else{var l=new Error("the request is error");t(l)}},y.open(b,e,w),Object.keys(d).forEach(function(l){y.setRequestHeader(l,d[l])});try{y.send(s)}catch(l){t(l)}})}}(ce)),ce}var T={},le={exports:{}},he={exports:{}},Be;function Fr(){return Be||(Be=1,function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,o){return e<<o|e>>>32-o},rotr:function(e,o){return e<<32-o|e>>>o},endian:function(e){if(e.constructor==Number)return r.rotl(e,8)&16711935|r.rotl(e,24)&4278255360;for(var o=0;o<e.length;o++)e[o]=r.endian(e[o]);return e},randomBytes:function(e){for(var o=[];e>0;e--)o.push(Math.floor(Math.random()*256));return o},bytesToWords:function(e){for(var o=[],n=0,t=0;n<e.length;n++,t+=8)o[t>>>5]|=e[n]<<24-t%32;return o},wordsToBytes:function(e){for(var o=[],n=0;n<e.length*32;n+=8)o.push(e[n>>>5]>>>24-n%32&255);return o},bytesToHex:function(e){for(var o=[],n=0;n<e.length;n++)o.push((e[n]>>>4).toString(16)),o.push((e[n]&15).toString(16));return o.join("")},hexToBytes:function(e){for(var o=[],n=0;n<e.length;n+=2)o.push(parseInt(e.substr(n,2),16));return o},bytesToBase64:function(e){for(var o=[],n=0;n<e.length;n+=3)for(var t=e[n]<<16|e[n+1]<<8|e[n+2],u=0;u<4;u++)n*8+u*6<=e.length*8?o.push(a.charAt(t>>>6*(3-u)&63)):o.push("=");return o.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/ig,"");for(var o=[],n=0,t=0;n<e.length;t=++n%4)t!=0&&o.push((a.indexOf(e.charAt(n-1))&Math.pow(2,-2*t+8)-1)<<t*2|a.indexOf(e.charAt(n))>>>6-t*2);return o}};he.exports=r}()),he.exports}var de,Pe;function Me(){if(Pe)return de;Pe=1;var a={utf8:{stringToBytes:function(r){return a.bin.stringToBytes(unescape(encodeURIComponent(r)))},bytesToString:function(r){return decodeURIComponent(escape(a.bin.bytesToString(r)))}},bin:{stringToBytes:function(r){for(var e=[],o=0;o<r.length;o++)e.push(r.charCodeAt(o)&255);return e},bytesToString:function(r){for(var e=[],o=0;o<r.length;o++)e.push(String.fromCharCode(r[o]));return e.join("")}}};return de=a,de}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var pe,De;function zr(){if(De)return pe;De=1,pe=function(e){return e!=null&&(a(e)||r(e)||!!e._isBuffer)};function a(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function r(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&a(e.slice(0,0))}return pe}var He;function Er(){return He||(He=1,function(){var a=Fr(),r=Me().utf8,e=zr(),o=Me().bin,n=function(t,u){t.constructor==String?u&&u.encoding==="binary"?t=o.stringToBytes(t):t=r.stringToBytes(t):e(t)?t=Array.prototype.slice.call(t,0):!Array.isArray(t)&&t.constructor!==Uint8Array&&(t=t.toString());for(var f=a.bytesToWords(t),w=t.length*8,i=1732584193,s=-271733879,h=-1732584194,d=271733878,v=0;v<f.length;v++)f[v]=(f[v]<<8|f[v]>>>24)&16711935|(f[v]<<24|f[v]>>>8)&4278255360;f[w>>>5]|=128<<w%32,f[(w+64>>>9<<4)+14]=w;for(var b=n._ff,x=n._gg,_=n._hh,m=n._ii,v=0;v<f.length;v+=16){var y=i,c=s,l=h,g=d;i=b(i,s,h,d,f[v+0],7,-680876936),d=b(d,i,s,h,f[v+1],12,-389564586),h=b(h,d,i,s,f[v+2],17,606105819),s=b(s,h,d,i,f[v+3],22,-1044525330),i=b(i,s,h,d,f[v+4],7,-176418897),d=b(d,i,s,h,f[v+5],12,1200080426),h=b(h,d,i,s,f[v+6],17,-1473231341),s=b(s,h,d,i,f[v+7],22,-45705983),i=b(i,s,h,d,f[v+8],7,1770035416),d=b(d,i,s,h,f[v+9],12,-1958414417),h=b(h,d,i,s,f[v+10],17,-42063),s=b(s,h,d,i,f[v+11],22,-1990404162),i=b(i,s,h,d,f[v+12],7,1804603682),d=b(d,i,s,h,f[v+13],12,-40341101),h=b(h,d,i,s,f[v+14],17,-1502002290),s=b(s,h,d,i,f[v+15],22,1236535329),i=x(i,s,h,d,f[v+1],5,-165796510),d=x(d,i,s,h,f[v+6],9,-1069501632),h=x(h,d,i,s,f[v+11],14,643717713),s=x(s,h,d,i,f[v+0],20,-373897302),i=x(i,s,h,d,f[v+5],5,-701558691),d=x(d,i,s,h,f[v+10],9,38016083),h=x(h,d,i,s,f[v+15],14,-660478335),s=x(s,h,d,i,f[v+4],20,-405537848),i=x(i,s,h,d,f[v+9],5,568446438),d=x(d,i,s,h,f[v+14],9,-1019803690),h=x(h,d,i,s,f[v+3],14,-187363961),s=x(s,h,d,i,f[v+8],20,1163531501),i=x(i,s,h,d,f[v+13],5,-1444681467),d=x(d,i,s,h,f[v+2],9,-51403784),h=x(h,d,i,s,f[v+7],14,1735328473),s=x(s,h,d,i,f[v+12],20,-1926607734),i=_(i,s,h,d,f[v+5],4,-378558),d=_(d,i,s,h,f[v+8],11,-2022574463),h=_(h,d,i,s,f[v+11],16,1839030562),s=_(s,h,d,i,f[v+14],23,-35309556),i=_(i,s,h,d,f[v+1],4,-1530992060),d=_(d,i,s,h,f[v+4],11,1272893353),h=_(h,d,i,s,f[v+7],16,-155497632),s=_(s,h,d,i,f[v+10],23,-1094730640),i=_(i,s,h,d,f[v+13],4,681279174),d=_(d,i,s,h,f[v+0],11,-358537222),h=_(h,d,i,s,f[v+3],16,-722521979),s=_(s,h,d,i,f[v+6],23,76029189),i=_(i,s,h,d,f[v+9],4,-640364487),d=_(d,i,s,h,f[v+12],11,-421815835),h=_(h,d,i,s,f[v+15],16,530742520),s=_(s,h,d,i,f[v+2],23,-995338651),i=m(i,s,h,d,f[v+0],6,-198630844),d=m(d,i,s,h,f[v+7],10,1126891415),h=m(h,d,i,s,f[v+14],15,-1416354905),s=m(s,h,d,i,f[v+5],21,-57434055),i=m(i,s,h,d,f[v+12],6,1700485571),d=m(d,i,s,h,f[v+3],10,-1894986606),h=m(h,d,i,s,f[v+10],15,-1051523),s=m(s,h,d,i,f[v+1],21,-2054922799),i=m(i,s,h,d,f[v+8],6,1873313359),d=m(d,i,s,h,f[v+15],10,-30611744),h=m(h,d,i,s,f[v+6],15,-1560198380),s=m(s,h,d,i,f[v+13],21,1309151649),i=m(i,s,h,d,f[v+4],6,-145523070),d=m(d,i,s,h,f[v+11],10,-1120210379),h=m(h,d,i,s,f[v+2],15,718787259),s=m(s,h,d,i,f[v+9],21,-343485551),i=i+y>>>0,s=s+c>>>0,h=h+l>>>0,d=d+g>>>0}return a.endian([i,s,h,d])};n._ff=function(t,u,f,w,i,s,h){var d=t+(u&f|~u&w)+(i>>>0)+h;return(d<<s|d>>>32-s)+u},n._gg=function(t,u,f,w,i,s,h){var d=t+(u&w|f&~w)+(i>>>0)+h;return(d<<s|d>>>32-s)+u},n._hh=function(t,u,f,w,i,s,h){var d=t+(u^f^w)+(i>>>0)+h;return(d<<s|d>>>32-s)+u},n._ii=function(t,u,f,w,i,s,h){var d=t+(f^(u|~w))+(i>>>0)+h;return(d<<s|d>>>32-s)+u},n._blocksize=16,n._digestsize=16,le.exports=function(t,u){if(t==null)throw new Error("Illegal argument "+t);var f=a.wordsToBytes(n(t,u));return u&&u.asBytes?f:u&&u.asString?o.bytesToString(f):a.bytesToHex(f)}}()),le.exports}var ve={exports:{}};/*! ***** BEGIN LICENSE BLOCK *****
 *!
 *! Copyright 2011-2012, 2014 Jean-Christophe Sirot <sirot@chelonix.com>
 *!
 *! This file is part of digest.js
 *!
 *! digest.js is free software: you can redistribute it and/or modify it under
 *! the terms of the GNU General Public License as published by the Free Software
 *! Foundation, either version 3 of the License, or (at your option) any later
 *! version.
 *!
 *! digest.js is distributed in the hope that it will be useful, but
 *! WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *! or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
 *! more details.
 *!
 *! You should have received a copy of the GNU General Public License along with
 *! digest.js. If not, see http://www.gnu.org/licenses/.
 *!
 *! ***** END LICENSE BLOCK *****  */var je;function Lr(){return je||(je=1,function(a,r){(function(){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,o){var n,t=new Uint8Array(this);o===void 0&&(o=t.length);var u=new ArrayBuffer(o-e),f=new Uint8Array(u);for(n=0;n<f.length;n++)f[n]=t[n+e];return u})})(),function(e){function o(){}o.prototype.processBlock=function(s){var h=this.current[0],d=this.current[1],v=this.current[2],b=this.current[3],x=this.current[4],_=[s[0]<<24|s[1]<<16|s[2]<<8|s[3],s[4]<<24|s[5]<<16|s[6]<<8|s[7],s[8]<<24|s[9]<<16|s[10]<<8|s[11],s[12]<<24|s[13]<<16|s[14]<<8|s[15],s[16]<<24|s[17]<<16|s[18]<<8|s[19],s[20]<<24|s[21]<<16|s[22]<<8|s[23],s[24]<<24|s[25]<<16|s[26]<<8|s[27],s[28]<<24|s[29]<<16|s[30]<<8|s[31],s[32]<<24|s[33]<<16|s[34]<<8|s[35],s[36]<<24|s[37]<<16|s[38]<<8|s[39],s[40]<<24|s[41]<<16|s[42]<<8|s[43],s[44]<<24|s[45]<<16|s[46]<<8|s[47],s[48]<<24|s[49]<<16|s[50]<<8|s[51],s[52]<<24|s[53]<<16|s[54]<<8|s[55],s[56]<<24|s[57]<<16|s[58]<<8|s[59],s[60]<<24|s[61]<<16|s[62]<<8|s[63]],m,y;for(y=16;y<80;y++)_.push((_[y-3]^_[y-8]^_[y-14]^_[y-16])<<1|(_[y-3]^_[y-8]^_[y-14]^_[y-16])>>>31);for(y=0;y<80;y++)m=(h<<5|h>>>27)+x+_[y],y<20?m+=(d&v|~d&b)+1518500249|0:y<40?m+=(d^v^b)+1859775393|0:y<60?m+=(d&v|d&b|v&b)+2400959708|0:m+=(d^v^b)+3395469782|0,x=b,b=v,v=d<<30|d>>>2,d=h,h=m;this.current[0]+=h,this.current[1]+=d,this.current[2]+=v,this.current[3]+=b,this.current[4]+=x,this.currentLen+=64},o.prototype.doPadding=function(){var s=(this.inLen+this.currentLen)*8,h=0,d=s&4294967295,v=this.inLen<=55?55-this.inLen:119-this.inLen,b=new Uint8Array(new ArrayBuffer(v+1+8));return b[0]=128,b[b.length-1]=d&255,b[b.length-2]=d>>>8&255,b[b.length-3]=d>>>16&255,b[b.length-4]=d>>>24&255,b[b.length-5]=h&255,b[b.length-6]=h>>>8&255,b[b.length-7]=h>>>16&255,b[b.length-8]=h>>>24&255,b},o.prototype.getDigest=function(){var s=new Uint8Array(new ArrayBuffer(20));return s[3]=this.current[0]&255,s[2]=this.current[0]>>>8&255,s[1]=this.current[0]>>>16&255,s[0]=this.current[0]>>>24&255,s[7]=this.current[1]&255,s[6]=this.current[1]>>>8&255,s[5]=this.current[1]>>>16&255,s[4]=this.current[1]>>>24&255,s[11]=this.current[2]&255,s[10]=this.current[2]>>>8&255,s[9]=this.current[2]>>>16&255,s[8]=this.current[2]>>>24&255,s[15]=this.current[3]&255,s[14]=this.current[3]>>>8&255,s[13]=this.current[3]>>>16&255,s[12]=this.current[3]>>>24&255,s[19]=this.current[4]&255,s[18]=this.current[4]>>>8&255,s[17]=this.current[4]>>>16&255,s[16]=this.current[4]>>>24&255,s.buffer},o.prototype.reset=function(){this.currentLen=0,this.inLen=0,this.current=new Uint32Array(new ArrayBuffer(20)),this.current[0]=1732584193,this.current[1]=4023233417,this.current[2]=2562383102,this.current[3]=271733878,this.current[4]=3285377520},o.prototype.blockLen=64,o.prototype.digestLen=20;var n=function(s){var h=new ArrayBuffer(s.length),d=new Uint8Array(h),v;for(v=0;v<s.length;v++)d[v]=s.charCodeAt(v);return d},t=function(s){var h=new ArrayBuffer(1),d=new Uint8Array(h);return d[0]=s,d},u=function(s){if(s.constructor===Uint8Array)return s;if(s.constructor===ArrayBuffer)return new Uint8Array(s);if(s.constructor===String)return n(s);if(s.constructor===Number){if(s>255)throw"For more than one byte, use an array buffer";if(s<0)throw"Input value must be positive";return t(s)}else throw"Unsupported type"},f=function(s){var h=function(b){for(var x=b.length,_=0;x>0;){var m=this.blockLen-this.inLen;m>x&&(m=x);var y=b.subarray(_,_+m);this.inbuf.set(y,this.inLen),_+=m,x-=m,this.inLen+=m,this.inLen===this.blockLen&&(this.processBlock(this.inbuf),this.inLen=0)}},d=function(){var b=this.doPadding();this.update(b);var x=this.getDigest();return this.reset(),x},v=function(){if(!s)throw"Unsupported algorithm: "+s.toString();s.prototype.update=h,s.prototype.finalize=d;var b=new s;return b.inbuf=new Uint8Array(new ArrayBuffer(b.blockLen)),b.reset(),b}();return{update:function(b){v.update(u(b))},finalize:function(){return v.finalize()},digest:function(b){return v.update(u(b)),v.finalize()},reset:function(){v.reset()},digestLength:function(){return v.digestLen}}},w=function(s){var h=!1,d,v,b,x=function(){var c,l;if(!h){if(d===void 0)throw"MAC key is not defined";for(d.byteLength>64?l=new Uint8Array(s.digest(d)):l=new Uint8Array(d),v=new Uint8Array(new ArrayBuffer(64)),c=0;c<l.length;c++)v[c]=54^l[c];for(c=l.length;c<64;c++)v[c]=54;for(b=new Uint8Array(new ArrayBuffer(64)),c=0;c<l.length;c++)b[c]=92^l[c];for(c=l.length;c<64;c++)b[c]=92;h=!0,s.update(v.buffer)}},_=function(){h=!1,d=void 0,v=void 0,b=void 0,s.reset()},m=function(){var c=s.finalize();return s.reset(),s.update(b.buffer),s.update(c),c=s.finalize(),_(),c},y=function(c){d=c};return{setKey:function(c){y(u(c)),x()},update:function(c){s.update(c)},finalize:function(){return m()},mac:function(c){return this.update(c),this.finalize()},reset:function(){_()},hmacLength:function(){return s.digestLength()}}},i={SHA1:function(){return f(o)},HMAC_SHA1:function(){return w(f(o))}};a.exports&&(a.exports=i)}()}(ve)),ve.exports}var $e;function qr(){if($e)return T;$e=1;var a=st();T.__esModule=!0,T.unix=t,T.blobToBuffer=u,T.assertOptions=f,T.getContentMd5=i,T.getCanonicalizedOSSHeaders=s,T.getCanonicalizedResource=h,T.getSignature=d;var r=a(Er()),e=a(dt()),o=a(Lr());function n(v){return v&&Object.prototype.toString.call(v)==="[object Date]"&&v.toString!=="Invalid Date"}function t(v){var b;return v&&(b=new Date(v)),n(b)||(b=new Date),Math.round(b.getTime()/1e3)}function u(v){return new Promise(function(b,x){var _=new FileReader;_.onload=function(){var m=new Uint8Array(_.result);b(m)},_.onerror=function(){x(_.error)},_.readAsArrayBuffer(v)})}function f(v){var b=v.accessKeyId,x=v.accessKeySecret,_=v.bucket,m=v.endpoint;if(!b)throw new Error("need accessKeyId");if(!x)throw new Error("need accessKeySecret");if(!_&&!m)throw new Error("need bucket or endpoint")}function w(v){for(var b=[],x=0;x<v.length;x+=2)b.push(parseInt(v[x]+v[x+1],16));return Uint8Array.from(b)}function i(v){var b=Array.prototype.slice.call(v,0),x=w((0,r.default)(b));return e.default.fromByteArray(x)}function s(v){var b="",x=Object.keys(v);return x=x.map(function(_){return _.toLowerCase()}),x.sort(),x.forEach(function(_){_.indexOf("x-oss-")===0&&(b+=_+":"+v[_]+`
`)}),b}function h(v,b,x){v===void 0&&(v=""),b===void 0&&(b="");var _="";v&&(_+="/"+v),b&&(b.charAt(0)!=="/"&&(_+="/"),_+=b);var m=""+_,y="?";if(x){var c=function(p,S){return p[0]>S[0]?1:p[0]<S[0]?-1:0},l=function(p){m+=y+p,x[p]&&(m+="="+x[p]),y="&"};Object.keys(x).sort(c).forEach(l)}return m}function d(v){v===void 0&&(v={});var b=v,x=b.type,_=x===void 0?"header":x,m=b.verb,y=m===void 0?"":m,c=b.contentMd5,l=c===void 0?"":c,g=b.expires,p=g===void 0?t()+3600:g,S=b.bucket,U=b.objectName,k=b.accessKeySecret,R=b.headers,E=R===void 0?{}:R,ee=b.subResource,L=E["x-oss-date"]||"",O=E["Content-Type"]||"",I=[y,l,O];_==="header"?I.push(L):I.push(p);var M=s(E),ut=h(S,U,ee);I.push(""+M+ut);var ft=I.join(`
`),te=new o.default.HMAC_SHA1;te.setKey(k),te.update(ft);var ct=new Uint8Array(te.finalize()),lt=e.default.fromByteArray(ct);return lt}return T}var Ke;function Br(){return Ke||(Ke=1,function(a){var r=st();a.__esModule=!0,a.default=void 0;var e=r(Rr()),o=r(Tr()),n=qr(),t=function(){function u(w){w===void 0&&(w={}),(0,n.assertOptions)(w),this.opts=(0,e.default)({region:"oss-cn-hangzhou",internal:!1,cname:!1,secure:!1,timeout:6e4},w);var i=this.opts,s=i.bucket,h=i.region,d=i.endpoint,v=i.internal;if(this.host="",d)this.host=d;else{var b=s;v&&(b+="-internal"),b+="."+h+".aliyuncs.com",this.host=b}}var f=u.prototype;return f.put=function(i,s,h){var d=this;return h===void 0&&(h={}),new Promise(function(v,b){(0,n.blobToBuffer)(s).then(function(x){var _=d.opts,m=_.accessKeyId,y=_.accessKeySecret,c=_.stsToken,l=_.bucket,g="PUT",p=(0,n.getContentMd5)(x),S=s.type,U={"Content-Md5":p,"Content-Type":S,"x-oss-date":new Date().toGMTString()};c&&(U["x-oss-security-token"]=c);var k=(0,n.getSignature)({verb:g,contentMd5:p,headers:U,bucket:l,objectName:i,accessKeyId:m,accessKeySecret:y});U.Authorization="OSS "+m+":"+k;var R=d.opts.secure?"https":"http",E=R+"://"+d.host+"/"+i;return(0,o.default)(E,{method:g,headers:U,data:s,timeout:d.opts.timeout,onprogress:h.onprogress})}).then(v).catch(b)})},f.putSymlink=function(i,s){var h=this.opts,d=h.accessKeyId,v=h.accessKeySecret,b=h.stsToken,x=h.bucket,_="PUT",m={"x-oss-date":new Date().toGMTString(),"x-oss-symlink-target":encodeURI(s)};b&&(m["x-oss-security-token"]=b);var y=(0,n.getSignature)({verb:_,headers:m,bucket:x,objectName:i,accessKeyId:d,accessKeySecret:v,subResource:{symlink:""}});m.Authorization="OSS "+d+":"+y;var c=this.opts.secure?"https":"http",l=c+"://"+this.host+"/"+i+"?symlink";return(0,o.default)(l,{method:_,headers:m,timeout:this.opts.timeout})},f.signatureUrl=function(i,s){s===void 0&&(s={});var h=s,d=h.expires,v=d===void 0?1800:d,b=h.method,x=h.process,_=h.response,m=this.opts,y=m.accessKeyId,c=m.accessKeySecret,l=m.stsToken,g=m.bucket,p={},S={};if(x){var U="x-oss-process";S[U]=x}_&&Object.keys(_).forEach(function(O){var I="response-"+O.toLowerCase();S[I]=_[O]}),Object.keys(s).forEach(function(O){var I=O.toLowerCase(),M=s[O];I.indexOf("x-oss-")===0?p[I]=M:I.indexOf("content-md5")===0||I.indexOf("content-type")===0?p[O]=M:I!=="expires"&&I!=="response"&&I!=="process"&&I!=="method"&&(S[I]=M)});var k=s["security-token"]||l;k&&(S["security-token"]=k);var R=(0,n.unix)()+v,E=(0,n.getSignature)({type:"url",verb:b||"GET",accessKeyId:y,accessKeySecret:c,bucket:g,objectName:i,headers:p,subResource:S,expires:R}),ee=this.opts.secure?"https":"http",L=ee+"://"+this.host+"/"+i;return L+="?OSSAccessKeyId="+y,L+="&Expires="+R,L+="&Signature="+encodeURIComponent(E),Object.keys(S).forEach(function(O){L+="&"+O+"="+encodeURIComponent(S[O])}),L},u}();a.default=t}(se)),se}var ye,Ge;function Hr(){return Ge||(Ge=1,ye=Br().default),ye}export{Dr as q,Hr as r,yr as u};
